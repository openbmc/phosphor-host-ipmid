{
  "comments": [
    {
      "key": {
        "uuid": "9cfcfa1c_d0f06648",
        "filename": "chassishandler.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1093,
      "author": {
        "id": 1000004
      },
      "writtenOn": "2020-02-05T16:30:59Z",
      "side": 1,
      "message": "So the problem I see is with this paths implementation:\nGracefulShutdown \tsoft off \tHost.Off\n\nThis path sends a message to the host. Once the host has shutdown, the host sends an inband IPMI CMD_POWER_OFF. To implement the GracefulShutdown path, we had to have this if/else in here to differentiate between when the real IPMI_CMD_POWER_OFF from an external user is sent vs. from the host as a part of the GracefulShutdown. I feel like we still need this timer, to ensure we handle the situations where the host never shuts itself down properly on a GracefulShutdown.\n\nI\u0027ve never really liked the complexity of this so looking for other ideas on how to address this issue. But as-is, this would break us due to the dual use of CMD_POWER_OFF.",
      "revId": "e3fb8d7d6fa9bbaebc8f0b760128be358118c0d5",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4c34c4dc_dd078e0c",
        "filename": "chassishandler.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1093,
      "author": {
        "id": 1000276
      },
      "writtenOn": "2020-02-05T19:24:19Z",
      "side": 1,
      "message": "I see.  This has been confusing to me, so it\u0027s good to understand the history a little better.\n\nIf I understand correctly, the issue is isolated to just the GracefulShutdown/Soft Off case?  \n\nUnfortunately, the Redfish and IPMI specs aren\u0027t very clear on what should happen if a graceful shutdown fails and whether the BMC should take further action on its own.\n\nWhat we usually do is lean toward doing exactly what the user requested. If the user requests a graceful shutdown, it\u0027s up to the host software to turn off and the BMC shouldn\u0027t take any further action.  If the host software hangs on a graceful shutdown, then the user can request a forced shutdown to resolve it.\n\nThis approach would also remove the complexity of the dual CMD_POWER_OFF behavior so it can behave as specified.",
      "parentUuid": "9cfcfa1c_d0f06648",
      "revId": "e3fb8d7d6fa9bbaebc8f0b760128be358118c0d5",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "65566386_a96fca99",
        "filename": "chassishandler.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1093,
      "author": {
        "id": 1000004
      },
      "writtenOn": "2020-02-05T19:51:41Z",
      "side": 1,
      "message": "I\u0027m pretty sure due to the expected behavior of our systems from our customers, we\u0027ll need to continue with the timeout concept. It\u0027s a fair point though that this is not the desired behavior of all systems and this code impacts the complexity and behavior of a common path. I\u0027ll talk with the team about alternatives on our part here.",
      "parentUuid": "4c34c4dc_dd078e0c",
      "revId": "e3fb8d7d6fa9bbaebc8f0b760128be358118c0d5",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2b81451e_427828d1",
        "filename": "chassishandler.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1093,
      "author": {
        "id": 1000004
      },
      "writtenOn": "2020-02-13T21:43:01Z",
      "side": 1,
      "message": "I thought I had a pretty easy solution to this one. It worked fine for the normal power off path. But the GracefulWarmReboot now breaks :(  The basic issue is that it feels like we\u0027ve combined two separate events from the host into one. There is the indication that the host has completed it\u0027s shutdown and there is a command to power off the system. They both are represented by CMD_POWER_OFF and without some sort of state machine logic to know whether it\u0027s a real power off or GracefulWarmReboot flow I\u0027m not sure what to do here? How do others handle this?",
      "parentUuid": "65566386_a96fca99",
      "revId": "e3fb8d7d6fa9bbaebc8f0b760128be358118c0d5",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    }
  ]
}